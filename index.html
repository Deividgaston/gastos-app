<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Gastos 2N Â· App</title>

  <link rel="stylesheet" href="assets/style.css">

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-storage-compat.js"></script>

  <!-- Utilidades (para export en otras pÃ¡ginas, no estorban aquÃ­) -->
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <!-- Config Firebase -->
  <script src="config.js"></script>
</head>
<body>
<header class="topbar">
  <h1>
    <img src="assets/2n-logo-black.png" alt="2N" style="height:20px;border-radius:4px;">
    Gastos 2N
  </h1>

  <a class="badge" href="kms.html">ğŸš— KM</a>
  <a class="badge" href="export.html">ğŸ“¤ Export</a>
  <a class="badge" href="summary.html">ğŸ“„ Summary</a>

  <div class="header-actions">
    <button id="btnConfigOCR" class="btn">âš™ï¸ Config OCR</button>
    <span id="whoami" class="badge">No autenticado</span>
    <button id="btnLogin" class="btn">Iniciar sesiÃ³n</button>
    <button id="btnLogout" class="btn danger" style="display:none">Salir</button>
  </div>
</header>

<main class="content">
  <div class="grid">
    <div class="card">
      <h2>Acciones rÃ¡pidas</h2>
      <div class="row">
        <button id="scanBtn" class="btn primary">ğŸ“¸ Escanear ticket</button>
        <button id="manualBtn" class="btn">ï¼‹ Ingreso manual</button>
      </div>
      <div class="small">
        Si no hay login, los apuntes se guardan localmente en este navegador.
      </div>
    </div>

    <div class="card">
      <h2>Notas recientes</h2>
      <div id="lista" class="list"></div>
    </div>
  </div>
</main>

<!-- MODAL REVISIÃ“N / GUARDADO -->
<div id="reviewModal" class="modal" aria-hidden="true">
  <div class="panel">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h2 style="margin:0;font-size:16px">Revisar y guardar</h2>
      <button id="closeReview" class="btn">Cerrar</button>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label>Fecha</label><br>
        <input id="revDate" type="date">
      </div>
      <div>
        <label>Importe (â‚¬)</label><br>
        <input id="revAmount" type="number" step="0.01">
      </div>
    </div>

    <div class="row">
      <div style="flex:1;min-width:150px">
        <label>Proveedor</label><br>
        <input id="revProvider">
      </div>
      <div>
        <label>CategorÃ­a</label><br>
        <select id="revCategory">
          <option value="comida">Comida</option>
          <option value="peajes">Peajes</option>
          <option value="gasolina">Gasolina</option>
          <option value="transporte">Transporte</option>
          <option value="alojamiento">Alojamiento</option>
          <option value="ocio">Ocio</option>
          <option value="servicios">Servicios</option>
          <option value="varios" selected>Varios</option>
          <option value="ingreso">Ingreso</option>
        </select>
      </div>
      <div>
        <label>Pagado con</label><br>
        <select id="revPaidWith">
          <option value="empresa" selected>Tarjeta empresa</option>
          <option value="personal">Mi dinero</option>
        </select>
      </div>
    </div>

    <div class="row">
      <textarea id="revNotes" rows="3" placeholder="Notas"></textarea>
      <img id="revThumb" class="thumb" alt="preview">
    </div>

    <div id="revFileInfo" class="small"></div>

    <div class="row" style="justify-content:space-between;margin-top:10px">
      <div class="row">
        <button id="btnPick" class="btn">ğŸ“ Adjuntar foto</button>
        <button id="btnCam" class="btn">ğŸ“· Tomar foto</button>
      </div>
      <button id="saveReview" class="btn primary">Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL CONFIG OCR -->
<div id="ocrModal" class="modal" aria-hidden="true">
  <div class="panel">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h2 style="margin:0;font-size:16px">Configurar OCR (Gemini)</h2>
      <button id="closeOCR" class="btn">Cerrar</button>
    </div>

    <div style="margin-top:10px">
      <label>API Key de Gemini</label><br>
      <input id="ocrKeyInput" type="text" style="width:100%">
      <div class="small" style="margin-top:6px">
        Se guarda solo en este dispositivo (localStorage).<br>
        Puedes conseguir tu API Key en <b>aistudio.google.com</b>.
      </div>
    </div>

    <div class="row" style="justify-content:space-between;margin-top:12px">
      <button id="btnTestKey" class="btn">Probar clave</button>
      <div class="row">
        <button id="btnSaveKey" class="btn primary">Guardar clave</button>
        <button id="btnClearKey" class="btn danger">Borrar clave</button>
      </div>
    </div>

    <div id="ocrStatus" class="small" style="margin-top:8px"></div>
  </div>
</div>

<script>
// (JS recortado aquÃ­ para mantenerlo pequeÃ±o en este entorno; en tu app real debes pegar el JS completo)
</script>

</body>
</html>
